<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Heartopia Tab Converter</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f6f6f6;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }

  textarea {
    width: 100%;
    min-height: 220px;
    margin: 10px 0;
    font-family: monospace;
    font-size: 14px;
    padding: 10px;
    box-sizing: border-box;
  }

  .tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }

  .tabs button {
    padding: 8px 14px;
    cursor: pointer;
    border: none;
    background: #ddd;
    border-radius: 6px;
  }

  .tabs button.active {
    background: #333;
    color: white;
  }

  .actions {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }

  button {
    padding: 8px 14px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #444;
    color: white;
  }

  label {
    display: block;
    margin: 10px 0;
  }

  select {
    padding: 6px;
    font-size: 14px;
  }
</style>
</head>

<body>

<h2>ðŸŽµ Heartopia Tab Converter</h2>

<div class="tabs">
  <button id="tab-normal" class="active" onclick="setMode('normal')">
    normal
  </button>
  <button id="tab-range" onclick="setMode('range')">
    2 octaves
  </button>
  <button id="tab-down" onclick="setMode('down')">
    1 octave down
  </button>
</div>

<textarea id="input" placeholder="Enter your tabs here"></textarea>

<div class="actions">
  <button onclick="convert()">Convert</button>
  <button onclick="copyResult()">Copy result</button>
</div>

<label>
  <input type="checkbox" id="kbdToggle" onchange="toggleKeyboard()">
  Convert to computer keyboard
</label>

<select id="kbdMode" style="display:none;">
  <option value="2oct">2 octaves (bass / lute / kalimba)</option>
  <option value="3oct">3 octaves (piano 22key)</option>
</select>

<textarea id="output" placeholder="Result" readonly></textarea>

<script>
let mode = "normal";

function setMode(newMode) {
  mode = newMode;
  ["normal", "range", "down"].forEach(m => {
    document.getElementById("tab-" + m)
      .classList.toggle("active", mode === m);
  });
}

function toggleKeyboard() {
  document.getElementById("kbdMode").style.display =
    document.getElementById("kbdToggle").checked ? "block" : "none";
}

/* ðŸŽ¹ keyboard mappings */
const keyboardMaps = {
  "2oct": {
    "1": "A", "2": "S", "3": "D", "4": "F", "5": "G", "6": "H", "7": "J",
    "1Â°": "Q", "2Â°": "W", "3Â°": "E", "4Â°": "R", "5Â°": "T", "6Â°": "Y", "7Â°": "U",
    "1Â°Â°": "I"
  },
  "3oct": {
    "1_": "Z", "2_": "X", "3_": "C", "4_": "V", "5_": "B", "6_": "N", "7_": "M",
    "1": "A", "2": "S", "3": "D", "4": "F", "5": "G", "6": "H", "7": "J",
    "1Â°": "Q", "2Â°": "W", "3Â°": "E", "4Â°": "R", "5Â°": "T", "6Â°": "Y", "7Â°": "U",
    "1Â°Â°": "I"
  }
};

function convert() {
  let text = document.getElementById("input").value;

  /* âœ… STEP 1: * â†’ Â° */
  text = text.replace(/\*/g, "Â°");

  /* âœ… STEP 2: octave logic */
  if (mode === "down") {
    text = text.replace(/(\d)(Â°*)/g, (m, d, deg) => {
      if (deg.length > 0) return d + deg.slice(1);
      return d + "_";
    });
  }

  /* normal + range = Ð±ÐµÐ· Ð·Ð¼Ñ–Ñ‰ÐµÐ½ÑŒ */

  /* âœ… STEP 3: keyboard */
  if (document.getElementById("kbdToggle").checked) {
    const map = keyboardMaps[document.getElementById("kbdMode").value];
    text = text.replace(/(\d(?:Â°Â°|Â°|_)?)/g, m => map[m] ?? m);
  }

  document.getElementById("output").value = text;
}

function copyResult() {
  const out = document.getElementById("output");
  out.select();
  document.execCommand("copy");
}
</script>

</body>
</html>
